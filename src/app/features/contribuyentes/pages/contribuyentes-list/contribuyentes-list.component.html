<div class="space-y-5">
    <div class="flex items-center space-x-2">
        <i class="pi pi-user"></i>
        <h3 class="text-xl font-semibold">Contribuyentes</h3>
    </div>

    <div class="flex justify-between">
        <p-iconfield iconPosition="left" class="w-1/3">
            <p-inputicon styleClass="pi pi-search"/>
            <input
                type="text"
                pInputText
                (input)="applyFilter($event)"
                placeholder="Buscar registro por palabra clave"
            />
        </p-iconfield>

        <p-button
            (click)="downloadContribuyentesExcel()"
            label="Descargar excel"
            icon="pi pi-download"
            severity="contrast"
        />
    </div>

    <div class="p-5 border rounded-xl text-sm">
        @if (!isLoading) {
            <p-table
                #table
                [value]="contribuyentes"
                [paginator]="true"
                [rows]="20"
                [showCurrentPageReport]="true"
                currentPageReportTemplate="Showing {first} to {last} from {totalRecords} records"
                [rowsPerPageOptions]="[20, 40, 50]"
                [globalFilterFields]="['nombre', 'email', 'telefono']"
                size="small"
            >
                <ng-template pTemplate="header">
                    <tr class="font-medium uppercase">
                        <th>Nombre</th>
                        <th>Correo eletrónico</th>
                        <th>Teléfono</th>
                        <!--<th>Estatus</th>-->
                        <th>Empresas</th>
                        <th>Menú</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-contribuyente>
                    <tr>
                        <td>{{ contribuyente.nombre }}</td>
                        <td>{{ contribuyente.email }}</td>
                        <td>{{ contribuyente.telefono }}</td>
                        <!--<td>{{ contribuyente.estatus }}</td>-->
                        <td>
                            <p-button
                                label="Ver empresas"
                                class="text-xs"
                                (click)="openContribuyentesCompaniesDialog(contribuyente)"
                                badge="{{ contribuyente.empresas.length }}"
                            />
                        </td>
                        <td class="space-x-3">
                            <p-button
                                icon="pi pi-ellipsis-v"
                                [rounded]="true"
                                severity="secondary"
                                [outlined]="true"
                                (click)="op.toggle($event)"
                            />
                            <p-popover #op>
                                <div class="w-52">
                                    <ul class="py-2 text-sm text-gray-700">
                                        <li>
                                            <a
                                                class="flex items-center space-x-2 px-4 py-2 hover:bg-gray-100 hover:cursor-pointer"
                                                (click)="openContribuyentesChangePasswordDialog(contribuyente)"
                                            >
                                                <i class="pi pi-lock"></i>
                                                <span>Cambiar contraseña</span>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </p-popover>
                        </td>
                    </tr>
                </ng-template>

                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="10">
                            <div
                                class="flex flex-col text-center p-24 space-y-4"
                            >
                                <i
                                    class="pi pi-folder-open text-gray-400"
                                    style="font-size: 2.5rem"
                                ></i>
                                <p class="font-medium text-lg text-gray-400">
                                    No se encontraron resultados
                                </p>
                            </div>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        } @else {
            <app-table-skeleton></app-table-skeleton>
        }
    </div>
</div>
